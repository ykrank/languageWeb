<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>ewp_util | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.3.4">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../ewp_yaws_util/ewp_yaws_util.html" />
    
    
    <link rel="prev" href="../ewp_unicode/ewp_unicode.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book" data-level="17" data-basepath=".." data-revision="1463048530419">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="cron_service/cron_service.html">
            
                
                    <a href="../cron_service/cron_service.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         cron_service
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="cs_api/cs_api.html">
            
                
                    <a href="../cs_api/cs_api.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         cs_api
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="evo/evo.html">
            
                
                    <a href="../evo/evo.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         evo
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="ewp_adapter/ewp_adapter.html">
            
                
                    <a href="../ewp_adapter/ewp_adapter.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         ewp_adapter
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="ewp_app_manager/ewp_app_manager.html">
            
                
                    <a href="../ewp_app_manager/ewp_app_manager.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         ewp_app_manager
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="ewp_channel_util/ewp_channel_util.html">
            
                
                    <a href="../ewp_channel_util/ewp_channel_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         ewp_channel_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="7" data-path="ewp_conf_util/ewp_conf_util.html">
            
                
                    <a href="../ewp_conf_util/ewp_conf_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                         ewp_conf_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="8" data-path="ewp_file_util/ewp_file_util.html">
            
                
                    <a href="../ewp_file_util/ewp_file_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                         ewp_file_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="9" data-path="ewp_http_client/ewp_http_client.html">
            
                
                    <a href="../ewp_http_client/ewp_http_client.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                         ewp_http_client
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="10" data-path="ewp_json/ewp_json.html">
            
                
                    <a href="../ewp_json/ewp_json.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                         ewp_json
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11" data-path="ewp_params/ewp_params.html">
            
                
                    <a href="../ewp_params/ewp_params.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                         ewp_params
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12" data-path="ewp_pubsub_service/ewp_pubsub_service.html">
            
                
                    <a href="../ewp_pubsub_service/ewp_pubsub_service.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                         ewp_pubsub_service
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13" data-path="ewp_render_util/ewp_render_util.html">
            
                
                    <a href="../ewp_render_util/ewp_render_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                         ewp_render_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="14" data-path="ewp_str_util/ewp_str_util.html">
            
                
                    <a href="../ewp_str_util/ewp_str_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                         ewp_str_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="15" data-path="ewp_time/ewp_time.html">
            
                
                    <a href="../ewp_time/ewp_time.html">
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                         ewp_time
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="16" data-path="ewp_unicode/ewp_unicode.html">
            
                
                    <a href="../ewp_unicode/ewp_unicode.html">
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                         ewp_unicode
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="17" data-path="ewp_util/ewp_util.html">
            
                
                    <a href="../ewp_util/ewp_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                         ewp_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="18" data-path="ewp_yaws_util/ewp_yaws_util.html">
            
                
                    <a href="../ewp_yaws_util/ewp_yaws_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                         ewp_yaws_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="19" data-path="push/push.html">
            
                
                    <a href="../push/push.html">
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                         push
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="20" data-path="session_service/session_service.html">
            
                
                    <a href="../session_service/session_service.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                         session_service
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="21" data-path="xml_eng/xml_eng.html">
            
                
                    <a href="../xml_eng/xml_eng.html">
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                         xml_eng
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="22" data-path="define/define.html">
            
                
                    <a href="../define/define.html">
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                         宏定义
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    

    
    
    
    

    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown">下载</a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                
                <a href="/emp/ewp_lib_example/ewp_lib_example.zip" class="button">html</a>
                
                
                <a href="/emp/ewp_lib_example/book.pdf" class="button">pdf</a>
                
                
            </div>
        </div>
    </div>

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_9">
                    
                        <h1 id="module-ewp-util">Module ewp _ util</h1>
<p>概述：一些通用API。</p>
<h2 id="fuctions">1 Fuctions</h2>
<h3 id="1collectonce2">1.1 1.collect_once/2</h3>
<p>(1)描述：依次对指定列表的各元素进行指定的函数运算，计算结果不为false时返回此结果并结束遍历列表。</p>
<p>根据指定错误信息生成响应。函数规格为fun(Element) -&gt; false | term()。</p>
<pre><code>collect_once(_Fun, []) -&gt; [];
collect_once(_Fun, W) when is_tuple(W) -&gt; [];
collect_once(Fun,  [H|T]) -&gt;
    case Fun(H) of
        false  -&gt; collect_once(Fun, T);
        Result -&gt; Result
    end.
</code></pre><p>(2)参考数据类型：</p>
<pre><code>(Fun :: function(), List :: list()) -&gt; term()
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)12&gt; ewp_util:collect_once(fun(X)-&gt;[X,X*3] end,[1|2]).
[1,3]
</code></pre><h3 id="2term-from-str1">1.2 2.term_ from _str/1</h3>
<p>(1)描述：在指定字符串中获取Erlang数据，如term_from_str(&quot;[{a, b, c}, {1, 2}]&quot;) -&gt; [{a, b, c}, {1, 2}]</p>
<pre><code>term_from_str(TermInStr) -&gt;
    {ok, ExprsTokens, _EndLine} = erl_scan:string(TermInStr ++ &quot;.&quot;),
    {ok, Exprs} = erl_parse:parse_exprs(ExprsTokens),
    {value, TermValue, _NewBindings} = erl_eval:exprs(Exprs, []),
    TermValue.
</code></pre><p>(2)参考数据类型：</p>
<pre><code>(string()) -&gt; term()
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)18&gt; ewp_util:term_from_str(&quot;[{a, b, c}, {1, 2}]&quot;).       
[{a,b,c},{1,2}]
</code></pre><h3 id="3stripws1">1.3 3.strip_ws/1</h3>
<p>(1)描述：去除指定字符串首尾的空白字符（空格，\t, \n, \r）</p>
<pre><code>strip_ws(Str) -&gt; strip_ws(Str, both).
</code></pre><p>(2)参考数据类型：</p>
<pre><code>(string()) -&gt; string()
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)29&gt; ewp_util:strip_ws(&quot;  test\t\r\n  &quot;).
&quot;test&quot;
</code></pre><h3 id="4randombytes1">1.4 4.random_bytes/1</h3>
<p>(1)描述：生成指定长度的随机字节列表。</p>
<pre><code>random_bytes(Len) -&gt;
    random_bytes_1(Len, []).
</code></pre><p>(2)参考数据类型：</p>
<pre><code>(integer()) -&gt; [random_byte()]
random_byte() = 1..256.
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)34&gt; ewp_util:random_bytes(5).
[153,123,171,235,153]
</code></pre><h3 id="5make-rfc1808-url2">1.5 5.make<em> rfc1808</em> url/2</h3>
<p>(1)描述：根据指定的参数生成基于RFC1808标准的url。</p>
<pre><code>make_rfc1808_url(BaseUrl, Href) when is_binary(BaseUrl) -&gt;
    make_rfc1808_url(ewp_str_util:to_list(BaseUrl), Href);
make_rfc1808_url(BaseUrl, Href) when is_binary(Href) -&gt;
    make_rfc1808_url(BaseUrl, ewp_str_util:to_list(Href));
make_rfc1808_url(&quot;&quot;, Href) -&gt;
    Href;
make_rfc1808_url(undefined, Href) -&gt;
    Href;
make_rfc1808_url(BaseUrl, undefined) -&gt;
    BaseUrl;
make_rfc1808_url(BaseUrl, Href) -&gt;
    #url{scheme = Scheme1,
         host = Host1,
         port = Port1,
         path = Path1,
         querypart = _Query1} = yaws_api:parse_url(BaseUrl),
    #url{scheme = Scheme2,
         host = _Host2,
         port = _Port2,
         path = Path2,
         querypart = _Query2} = 
             try
                 yaws_api:parse_url(Href)
             catch
                 _:_ -&gt;
                     ewp_util:parse_partial_url(Href)
             end,
    PortStr = if  Port1 == 80 orelse Port1 == 443 orelse Port1 == undefined -&gt;
                      &quot;&quot;;
                  true -&gt;
                      &quot;:&quot; ++ integer_to_list(Port1)
              end,
    if  Scheme2 == undefined -&gt;
            U1 = atom_to_list(Scheme1)++&quot;://&quot;++Host1++PortStr,
            BasePath = case string:rchr(Path1, $/) of 
                           0 -&gt; &quot;&quot;;
                           Idx2 -&gt; string:substr(Path1, 1, Idx2-1)
                       end,
            case string:substr(Path2, 1, 1) of
                &quot;/&quot; -&gt;      
                    U1 ++ Href;
                _ -&gt; 
                    case BasePath of
                        &quot;&quot; -&gt;
                            U1 ++ &quot;/&quot; ++ Href;
                        _ -&gt;
                            %% Path parsed by yaws_api:parse_url always starts with /
                            U1 ++ BasePath ++
                                case string:substr(BasePath, length(BasePath)) of
                                    &quot;/&quot; -&gt;
                                        Href;
                                    _ -&gt;
                                        &quot;/&quot; ++ Href
                                end
                    end
            end;
        true -&gt;
            Href
    end.
</code></pre><p>(2)参考数据类型：</p>
<pre><code>(string(), string()) -&gt; string()
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)38&gt; ewp_util:make_rfc1808_url(&quot;https://www.baidu.com&quot;, &quot;Herf&quot;). 
&quot;https://www.baidu.com/Herf&quot;
</code></pre><h3 id="6filterproplist1">1.6 6.filter_proplist/1</h3>
<p>(1)描述：过滤指定的proplist中值为undefined或&quot;&quot;的键值对。</p>
<pre><code>filter_proplist(List) -&gt;
    filter_proplist_1(List, []).
</code></pre><p>(2)参考数据类型：</p>
<pre><code>(proplist()) -&gt; proplist()
proplist() = [{Key :: term(), Value :: term()}]
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)14&gt; ewp_util:filter_proplist([{&quot;id&quot;,123},{&quot;name&quot;,&quot;Mary&quot;}]).
[{&quot;name&quot;,&quot;Mary&quot;},{&quot;id&quot;,123}]
</code></pre><h3 id="7eachline2">1.7 7.each_line/2</h3>
<p>(1)描述：对指定字符串的每一行执行指定函数运算。函数返回{stop, Value}时，返回Value值并停止遍历字符串。</p>
<pre><code>each_line(Fun, Str) -&gt;
    each_line_1(Fun, Str, []).
</code></pre><p>(2)函数规格为：</p>
<pre><code>fun(string()) -&gt; {stop, Value :: term()) | term()
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)12&gt; ewp_util:each_line(fun(X)-&gt;[X,lists:reverse(X)] end, &quot;test&quot;).       
[&quot;test&quot;,&quot;tset&quot;]
</code></pre><h3 id="8gen-req-body-from-list1">1.8 8.gen<em> req</em> body<em> from</em> list/1</h3>
<p>(1)描述：根据指定的proplist生成请求参数字符串。</p>
<pre><code>gen_req_body_from_list(List) -&gt;
    lists:foldl(fun({_Key,undefined},Acc) -&gt;
                        Acc;
                   ({_Key,[]},Acc) -&gt;
                        Acc;
                   ({Key,Value},Acc) -&gt;
                        Acc ++ case Acc of
                                   [] -&gt;
                                       &quot;&quot;;
                                   _ -&gt;
                                       &quot;&amp;&quot;
                               end ++
                            ewp_str_util:uri_escape(ewp_str_util:to_list(Key)) ++ &quot;=&quot; ++
                            ewp_str_util:uri_escape(ewp_str_util:to_list(Value))
                end,[],List).
</code></pre><p>(2)参考数据类型：</p>
<pre><code>([{Key :: string(), Value :: string()}]) -&gt; string()
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)16&gt; ewp_util:gen_req_body_from_list([{&quot;id&quot;,123},{&quot;name&quot;,&quot;test&quot;}]).
&quot;id=123&amp;name=test&quot;
</code></pre><h3 id="9loghelper1">1.9 9.log_helper/1</h3>
<p>(1)描述：将给定的文本写入文件中，文件会保存为启动路径下的report.log。</p>
<pre><code>log_helper(Content) -&gt;
    {ok,Dir} = file:get_cwd(),
    Fp_jad = case file:open(Dir++&quot;/report.log&quot;, [write]) of
                 {ok,IoDevice}-&gt;
                     IoDevice;
                 _-&gt;
                     undefined
             end,
    file:pwrite(Fp_jad,0,Content),
    file:close(Fp_jad).
</code></pre><p>(2)参考数据类型：</p>
<pre><code>(string() | binary()) -&gt; void()
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)17&gt; ewp_util:log_helper(&quot;Content&quot;).                               
ok
</code></pre><h3 id="10parse-query-stringquerystr1">1.10 10.parse<em> query</em> string(QueryStr)/1</h3>
<p>(1)描述：将指定的请求参数字符串转换成proplist()。</p>
<pre><code>parse_query_string(QueryStr) -&gt;
    ParPairs =  re:split(QueryStr, &quot;&amp;&quot;, [{return, list}]),
    lists:map(
      fun (ParPair) -&gt;
              case re:split(ParPair, &quot;=&quot;, [{return, list}]) of
                  [Name, Value] -&gt;
                      {Name,
                       case string:chr(Value, $%) of
                           0 -&gt; Value;
                           _ -&gt; yaws_api:url_decode(Value)
                       end};
                  _ -&gt; {ParPair, &quot;&quot;}
              end
      end, ParPairs).
</code></pre><p>(2)参考数据类型：</p>
<pre><code>(string()) -&gt; [{Key :: string(), Value :: string()}]
</code></pre><p>(3)编译运行效果为：</p>
<pre><code>(ebank@tracvm)19&gt; ewp_util:parse_query_string(&quot;QueryStr&quot;).  
[{&quot;QueryStr&quot;,[]}]
</code></pre>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../ewp_unicode/ewp_unicode.html" class="navigation navigation-prev " aria-label="Previous page: ewp_unicode"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../ewp_yaws_util/ewp_yaws_util.html" class="navigation navigation-next " aria-label="Next page: ewp_yaws_util"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
