<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>ewp_adapter | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.3.4">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../ewp_app_manager/ewp_app_manager.html" />
    
    
    <link rel="prev" href="../evo/evo.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book" data-level="4" data-basepath=".." data-revision="1463048530419">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="cron_service/cron_service.html">
            
                
                    <a href="../cron_service/cron_service.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         cron_service
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="cs_api/cs_api.html">
            
                
                    <a href="../cs_api/cs_api.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         cs_api
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="evo/evo.html">
            
                
                    <a href="../evo/evo.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         evo
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="4" data-path="ewp_adapter/ewp_adapter.html">
            
                
                    <a href="../ewp_adapter/ewp_adapter.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         ewp_adapter
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="ewp_app_manager/ewp_app_manager.html">
            
                
                    <a href="../ewp_app_manager/ewp_app_manager.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         ewp_app_manager
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="ewp_channel_util/ewp_channel_util.html">
            
                
                    <a href="../ewp_channel_util/ewp_channel_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         ewp_channel_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="7" data-path="ewp_conf_util/ewp_conf_util.html">
            
                
                    <a href="../ewp_conf_util/ewp_conf_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                         ewp_conf_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="8" data-path="ewp_file_util/ewp_file_util.html">
            
                
                    <a href="../ewp_file_util/ewp_file_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                         ewp_file_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="9" data-path="ewp_http_client/ewp_http_client.html">
            
                
                    <a href="../ewp_http_client/ewp_http_client.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                         ewp_http_client
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="10" data-path="ewp_json/ewp_json.html">
            
                
                    <a href="../ewp_json/ewp_json.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                         ewp_json
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11" data-path="ewp_params/ewp_params.html">
            
                
                    <a href="../ewp_params/ewp_params.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                         ewp_params
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12" data-path="ewp_pubsub_service/ewp_pubsub_service.html">
            
                
                    <a href="../ewp_pubsub_service/ewp_pubsub_service.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                         ewp_pubsub_service
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13" data-path="ewp_render_util/ewp_render_util.html">
            
                
                    <a href="../ewp_render_util/ewp_render_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                         ewp_render_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="14" data-path="ewp_str_util/ewp_str_util.html">
            
                
                    <a href="../ewp_str_util/ewp_str_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                         ewp_str_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="15" data-path="ewp_time/ewp_time.html">
            
                
                    <a href="../ewp_time/ewp_time.html">
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                         ewp_time
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="16" data-path="ewp_unicode/ewp_unicode.html">
            
                
                    <a href="../ewp_unicode/ewp_unicode.html">
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                         ewp_unicode
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="17" data-path="ewp_util/ewp_util.html">
            
                
                    <a href="../ewp_util/ewp_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                         ewp_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="18" data-path="ewp_yaws_util/ewp_yaws_util.html">
            
                
                    <a href="../ewp_yaws_util/ewp_yaws_util.html">
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                         ewp_yaws_util
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="19" data-path="push/push.html">
            
                
                    <a href="../push/push.html">
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                         push
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="20" data-path="session_service/session_service.html">
            
                
                    <a href="../session_service/session_service.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                         session_service
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="21" data-path="xml_eng/xml_eng.html">
            
                
                    <a href="../xml_eng/xml_eng.html">
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                         xml_eng
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="22" data-path="define/define.html">
            
                
                    <a href="../define/define.html">
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                         宏定义
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    

    
    
    
    

    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown">下载</a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                
                <a href="/emp/ewp_lib_example/ewp_lib_example.zip" class="button">html</a>
                
                
                <a href="/emp/ewp_lib_example/book.pdf" class="button">pdf</a>
                
                
            </div>
        </div>
    </div>

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_6">
                    
                        <h1 id="module-ewpadapter">Module ewp_adapter</h1>
<!-- toc -->
<ul>
<li><a href="#介绍">介绍</a></li>
<li><a href="#api-functions">API Functions</a><ul>
<li><a href="#invokeprocedure3">invoke_procedure/3</a></li>
<li><a href="#invokeprocedure4">invoke_procedure/4</a></li>
<li><a href="#invokeprocedure5">invoke_procedure/5</a></li>
</ul>
</li>
</ul>
<!-- toc stop -->
<h2 id="介绍">1 介绍</h2>
<p>在Module的开发中，我们需要使用适配器(Adapter)从第三方service获取数据。Adapter为EWP App提供了连接数据后台、获取数据和数据格式转换的功能，支持HTTP、TCP、Erlang RPC协议，也可以由App根据实际情况扩展协议。Adapter统一了输入的数据格式，使得调用者无需关注协议的具体实现，为App开发提供了很大的便捷性。一个Adapter由若干个Procedure组成，Procedure定义了从服务器获取指定数据的交互过程。关于Adapter和Procedure的配置方法请参照EMP用户手册中的<a href="http://192.168.64.165/emp5.2/get_started/deepin_app_dev/adapter/deploy_adapter.html" target="_blank">配置适配器</a>章节。</p>
<p>本章节将介绍EWP的模块ewp_adapter，该模块提供了<code>invoke_procedure</code>方法，用来调用已配置好的Procedure，该方法会完成输入检查、连接后台、获取数据、数据转换等一系列处理流程，并将结果返回给调用者。下面详细说明其使用方法。</p>
<h2 id="api-functions">2 API Functions</h2>
<h3 id="invokeprocedure3">2.1 invoke_procedure/3</h3>
<p>相当于：</p>
<pre><code>invoke_procedure(AdapterName, ProcedureId, Params) -&gt;
    invoke_procedure(AdapterName, ProcedureId, Params, [], []).
</code></pre><p>详见invoke_procedure/5.</p>
<h3 id="invokeprocedure4">2.2 invoke_procedure/4</h3>
<p>相当于：</p>
<pre><code>invoke_procedure(AdapterName, ProcedureId, Params, Options) -&gt;
    invoke_procedure(AdapterName, ProcedureId, Params, Options, []).
</code></pre><p>详见invoke_procedure/5.</p>
<h3 id="invokeprocedure5">2.3 invoke_procedure/5</h3>
<p>调用指定的procedure，调用成功则按procedure指定的格式返回结果，失败返回{error, Reason}。</p>
<p>输入参数和返回结果的数据类型如下：</p>
<pre><code>invoke_procedure(AdapterName::string(), ProcedureId::string(), Params::params(), Options::options(), Extra::user_data()) -&gt; {error, term()} | res()
params() = [{Key :: string(), Value :: string()}].
options() = [{Key :: string() | atom(), Option :: term()}].
user_data() = term().
res() = term().
</code></pre><p>其中：</p>
<p>参数AdapterName和ProcedureId分别为配置好的适配器name值和对应procedure的id，例如我们在&quot;config/adapter.conf&quot;文件中配置如下：</p>
<pre><code>{adapter, [{name, &quot;simulator&quot;},
              {host, &quot;localhost&quot;},
           {protocol, http},
           {port, 4003},
           {return_type, xml}]
}.

{procedure, [{id, &quot;mb0202&quot;},
             {adapter, &quot;simulator&quot;},
             {return_type, xml},
             {path, &quot;ebank&quot;},
             {gen_log, true},
             {use_sample_data,true},
             {data_sample, &quot;public/test/mb0202.xml&quot;},
             {parameters, [{&quot;tranCode&quot;, &quot;mb0202&quot;}, {&quot;accNo&quot;, &quot;1234567&quot;}]}]
}.
</code></pre><p>则调用<code>invoke_procedure</code>时第一个参数AdapterName为&quot;simulator&quot;，第二个参数ProcedureId为&quot;mb0202&quot;。</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../evo/evo.html" class="navigation navigation-prev " aria-label="Previous page: evo"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../ewp_app_manager/ewp_app_manager.html" class="navigation navigation-next " aria-label="Next page: ewp_app_manager"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
