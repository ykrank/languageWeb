<!DOCTYPE html>



























































































<html>
<head>


<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width" />

<meta name="Description" content="The server side of Google Cloud Messaging (GCM) consists of two components: A full GCM implementation requires both a client implementation and a server implementation. For more information about implementing the client side, see Implementing GCM Client…">
<link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico" />
<title>Implementing GCM Server | Android Developers</title>

<!-- STYLESHEETS -->
<link rel="stylesheet"
href="http://fonts.googleapis.com/css?family=Roboto+Condensed">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:light,regular,medium,thin,italic,mediumitalic,bold"
  title="roboto">
<link href="../../assets/css/default.css?v=5" rel="stylesheet" type="text/css">



<!-- JAVASCRIPT -->
<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script src="../../assets/js/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "../../";
  var metaTags = [];
  var devsite = false;
</script>
<script src="../../assets/js/docs.js?v=3" type="text/javascript"></script>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5831155-1', 'android.com');
  ga('create', 'UA-49880327-2', 'android.com', {'name': 'universal'});  // New tracker);
  ga('send', 'pageview');
  ga('universal.send', 'pageview'); // Send page view for new tracker.
</script>

</head>

<body class="gc-documentation

google" itemscope itemtype="http://schema.org/Article">

<a name="top"></a>

<!-- dialog to prompt lang pref change when loaded from hardcoded URL 
<div id="langMessage" style="display:none">
  <div>
    <div class="lang en">
      <p>You requested a page in English, would you like to proceed with this language setting?</p>
    </div>
    <div class="lang es">
      <p>You requested a page in Spanish (Español), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang ja">
      <p>You requested a page in Japanese (日本語), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang ko">
      <p>You requested a page in Korean (한국어), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang ru">
      <p>You requested a page in Russian (Русский), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang zh-cn">
      <p>You requested a page in Simplified Chinese (简体中文), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang zh-tw">
      <p>You requested a page in Traditional Chinese (繁體中文), would you like to proceed with this language setting?</p>
    </div>
    <a href="#" class="button yes" onclick="return false;">
      <span class="lang en">Yes</span>
      <span class="lang es">Sí</span>
      <span class="lang ja">Yes</span>
      <span class="lang ko">Yes</span>
      <span class="lang ru">Yes</span>
      <span class="lang zh-cn">是的</span>
      <span class="lang zh-tw">没有</span>
    </a>
    <a href="#" class="button" onclick="$('#langMessage').hide();return false;">
      <span class="lang en">No</span>
      <span class="lang es">No</span>
      <span class="lang ja">No</span>
      <span class="lang ko">No</span>
      <span class="lang ru">No</span>
      <span class="lang zh-cn">没有</span>
      <span class="lang zh-tw">没有</span>
    </a>
  </div>
</div> -->


  <!-- Header -->
  <div id="header-wrapper">
    <div id="header">

    


      <div class="wrap" id="header-wrap">
        <div class="col-3 logo">
          <a href="../../index.html">
            <img src="../../assets/images/dac_logo.png"
                srcset="../../assets/images/dac_logo@2x.png 2x"
                width="123" height="25" alt="Android Developers" />
          </a>
          <div class="btn-quicknav" id="btn-quicknav">
            <a href="#" class="arrow-inactive">Quicknav</a>
            <a href="#" class="arrow-active">Quicknav</a>
          </div>
        </div>
        <ul class="nav-x col-9">
            <li class="design">
              <a href="../../design/index.html"
              zh-tw-lang="設計"
              zh-cn-lang="设计"
              ru-lang="Проектирование"
              ko-lang="디자인"
              ja-lang="設計"
              es-lang="Diseñar"
              >Design</a></li>
            <li class="develop"><a href="../../develop/index.html"
              zh-tw-lang="開發"
              zh-cn-lang="开发"
              ru-lang="Разработка"
              ko-lang="개발"
              ja-lang="開発"
              es-lang="Desarrollar"
              >Develop</a></li>
            <li class="distribute last"><a href="../../distribute/googleplay/index.html"
              zh-tw-lang="發佈"
              zh-cn-lang="分发"
              ru-lang="Распространение"
              ko-lang="배포"
              ja-lang="配布"
              es-lang="Distribuir"
              >Distribute</a></li>
        </ul>


        
        
<div class="menu-container">
  <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Links</div>
      <ul>
        <li><a href="https://play.google.com/apps/publish/" target="_googleplay">Google Play Developer Console</a></li>
        <li><a href="http://android-developers.blogspot.com/">Android Developers Blog</a></li>
        <li><a href="../../about/index.html">About Android</a></li>
      </ul>
      <div class="header">Android Sites</div>
      <ul>
        <li><a href="http://www.android.com">Android.com</a></li>
        <li class="active"><a>Android Developers</a></li>
        <li><a href="http://source.android.com">Android Open Source Project</a></li>
      </ul>

      
      
      
      <br class="clearfix" />
    </div><!-- end 'mid' -->
    <div class="bottom"></div>
  </div><!-- end 'moremenu' -->

  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q"
          onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)"
          onkeydown="return search_changed(event, true, '../../')"
          onkeyup="return search_changed(event, false, '../../')" />
      </form>
      <div class="right"></div>
      <a class="close hide">close</a>
      <div class="left"></div>
      <div class="right"></div>
    </div><!-- end search-inner -->
  </div><!-- end search-container -->

  <div class="search_filtered_wrapper reference">
    <div class="suggest-card reference no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  <div class="search_filtered_wrapper docs">
    <div class="suggest-card dummy no-display">&nbsp;</div>
    <div class="suggest-card develop no-display">
      <ul class="search_filtered">
      </ul>
      <div class="child-card guides no-display">
      </div>
      <div class="child-card training no-display">
      </div>
      <div class="child-card samples no-display">
      </div>
    </div>
    <div class="suggest-card design no-display">
      <ul class="search_filtered">
      </ul>
    </div>
    <div class="suggest-card distribute no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>
</div><!-- end menu-container (search and menu widget) -->



        <!-- Expanded quicknav -->
        <div id="quicknav" class="col-13">
          <ul>
            <li class="about">
              <ul>
                <li><a href="../../about/index.html">About</a></li>
                <li><a href="../../wear/index.html">Wear</a></li>
                <li><a href="../../tv/index.html">TV</a></li>
                <li><a href="../../auto/index.html">Auto</a></li>
              </ul>
            </li>
            <li class="design">
              <ul>
                <li><a href="../../design/index.html">Get Started</a></li>
                <li><a href="../../design/devices.html">Devices</a></li>
                <li><a href="../../design/style/index.html">Style</a></li>
                <li><a href="../../design/patterns/index.html">Patterns</a></li>
                <li><a href="../../design/building-blocks/index.html">Building Blocks</a></li>
                <li><a href="../../design/downloads/index.html">Downloads</a></li>
                <li><a href="../../design/videos/index.html">Videos</a></li>
              </ul>
            </li>
            <li class="develop">
              <ul>
                <li><a href="../../training/index.html"
                  zh-tw-lang="訓練課程"
                  zh-cn-lang="培训"
                  ru-lang="Курсы"
                  ko-lang="교육"
                  ja-lang="トレーニング"
                  es-lang="Capacitación"
                  >Training</a></li>
                <li><a href="../../guide/index.html"
                  zh-tw-lang="API 指南"
                  zh-cn-lang="API 指南"
                  ru-lang="Руководства по API"
                  ko-lang="API 가이드"
                  ja-lang="API ガイド"
                  es-lang="Guías de la API"
                  >API Guides</a></li>
                <li><a href="../../reference/packages.html"
                  zh-tw-lang="參考資源"
                  zh-cn-lang="参考"
                  ru-lang="Справочник"
                  ko-lang="참조문서"
                  ja-lang="リファレンス"
                  es-lang="Referencia"
                  >Reference</a></li>
                <li><a href="../../sdk/index.html"
                  zh-tw-lang="相關工具"
                  zh-cn-lang="工具"
                  ru-lang="Инструменты"
                  ko-lang="도구"
                  ja-lang="ツール"
                  es-lang="Herramientas"
                  >Tools</a>
                </li>
                <li><a href="../../google/index.html">Google Services</a>
                </li>
                
              </ul>
            </li>
            <li class="distribute last">
              <ul>
                <li><a href="../../distribute/googleplay/index.html">Google Play</a></li>
                <li><a href="../../distribute/essentials/index.html">Essentials</a></li>
                <li><a href="../../distribute/users/index.html">Get Users</a></li>
                <li><a href="../../distribute/engage/index.html">Engage &amp; Retain</a></li>
                <li><a href="../../distribute/monetize/index.html">Monetize</a></li>
                <li><a href="../../distribute/analyze/index.html">Analyze</a></li>
                <li><a href="../../distribute/tools/index.html">Tools &amp; Reference</a></li>
                <li><a href="../../distribute/stories/index.html">Developer Stories</a></li>
              </ul>
            </li>
          </ul>
        </div><!-- /Expanded quicknav -->
      </div><!-- end header-wrap.wrap -->
    </div><!-- end header -->

  
    <!-- Secondary x-nav -->
    <div id="nav-x">
        <div class="wrap" style="position:relative;z-index:1">

        

            <ul class="nav-x col-9 develop" style="width:100%">
                <li class="training"><a href="../../training/index.html"
                  zh-tw-lang="訓練課程"
                  zh-cn-lang="培训"
                  ru-lang="Курсы"
                  ko-lang="교육"
                  ja-lang="トレーニング"
                  es-lang="Capacitación"
                  >Training</a></li>
                <li class="guide"><a href="../../guide/index.html"
                  zh-tw-lang="API 指南"
                  zh-cn-lang="API 指南"
                  ru-lang="Руководства по API"
                  ko-lang="API 가이드"
                  ja-lang="API ガイド"
                  es-lang="Guías de la API"
                  >API Guides</a></li>
                <li class="reference"><a href="../../reference/packages.html"
                  zh-tw-lang="參考資源"
                  zh-cn-lang="参考"
                  ru-lang="Справочник"
                  ko-lang="참조문서"
                  ja-lang="リファレンス"
                  es-lang="Referencia"
                  >Reference</a></li>
                <li class="tools"><a href="../../sdk/index.html"
                  zh-tw-lang="相關工具"
                  zh-cn-lang="工具"
                  ru-lang="Инструменты"
                  ko-lang="도구"
                  ja-lang="ツール"
                  es-lang="Herramientas"
                  >Tools</a></li>
                <li class="google"><a href="../../google/index.html"
                  >Google Services</a>
                </li>
                
            </ul>
        </div>
    </div>
    <!-- /Sendondary x-nav DEVELOP -->

  

    <div id="searchResults" class="wrap" style="display:none;">
      <h2 id="searchTitle">Results</h2>
      <div id="leftSearchControl" class="search-control">Loading...</div>
    </div>
  </div> <!--end header-wrapper -->

  <div id="sticky-header">
    <div>
      <a class="logo" href="#top"></a>
      <a class="top" href="#top"></a>
      <ul class="breadcrumb">
        
        <li class="current">Implementing GCM Server</li>
      </ul>
    </div>
  </div>




  <div class="wrap clearfix" id="body-content">
    <div class="col-4" id="side-nav" itemscope itemtype="http://schema.org/SiteNavigationElement">
      <div id="devdoc-nav" class="scroll-pane">



<ul id="nav">

  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/index.html">
          <span class="en">Overview</span>
      </a></div>
  </li>

  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/games.html">
          <span class="en">Games</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/location.html">
          <span class="en">Location</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/plus.html">
          <span class="en">Google+</span>
                </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/maps.html">
          <span class="en">Maps</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/drive.html">
          <span class="en">Drive</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/cast.html">
          <span class="en">Cast</span>
      </a></div>
  </li>
  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/play-services/ads.html">
      <span class="en">Ads</span></a>
    </div>
    <ul>
      <li><a href="../../google/play-services/id.html">
          <span class="en">Advertising ID</span></a>
      </li>
    </ul>
  </li>
  <li class="nav-section">
    <div class="nav-section-header empty"><a href="../../google/play-services/wallet.html">
          <span class="en">Wallet</span>
      </a></div>
  </li>


  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/play-services/index.html">
      <span class="en">Google Play Services</span></a>
    </div>
    <ul>
      <li><a href="../../google/play-services/setup.html">
          <span class="en">Setting Up Google Play Services</span></a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../google/auth/api-client.html">
          <span class="en">Accessing Google APIs</span></a>
        </div>
        <ul>
          <li>
            <a href="../../google/auth/http-auth.html">
              <span class="en">Authorizing with Google for REST APIs</span>
            </a>
          </li>
        </ul>
      </li>
      <li id="gms-tree-list" class="nav-section">
        <div class="nav-section-header">
          <a href="../../reference/gms-packages.html">
            <span class="en">Reference</span>
          </a>
        <div>
      </li>
    </ul>
  </li>


  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/play/billing/index.html" zh-cn-lang="应用内结算">
      <span class="en">Google Play In-app Billing</span></a>
    </div>
    <ul>
      <li><a href="../../google/play/billing/billing_overview.html" zh-cn-lang="应用内结算概述">
              <span class="en">Overview</span></a>
      </li>
      <li class="nav-section"><div class="nav-section-header"><a href="../../google/play/billing/api.html" zh-cn-lang="应用内结算 API">
              <span class="en">Version 3 API</span></a></div>
              <ul>
              <li><a href="../../google/play/billing/billing_integrate.html">
              <span class="en">Implementing the API</span></a></li>
              <li><a href="../../google/play/billing/billing_reference.html">
              <span class="en">Reference</span></a></li>
              </ul>
      </li>
      <li class="nav-section"><div class="nav-section-header"><a href="../../google/play/billing/v2/api.html">
              <span class="en">Version 2 API</span></a></div>
              <ul>
              <li><a href="../../google/play/billing/v2/billing_integrate.html">
              <span class="en">Implementing the API</span></a></li>
              <li><a href="../../google/play/billing/v2/billing_subscriptions.html">
              <span class="en">Subscriptions</span></a></li>
              <li><a href="../../google/play/billing/v2/billing_reference.html">
              <span class="en">Reference</span></a></li>
              </ul>
      </li>
      <li><a href="../../google/play/billing/billing_subscriptions.html">
              <span class="en">Subscriptions</span></a>
      </li>
      <li><a href="../../google/play/billing/billing_best_practices.html" zh-cn-lang="安全性和设计">
              <span class="en">Security and Design</span></a>
      </li>
      <li><a href="../../google/play/billing/billing_testing.html" zh-cn-lang="测试应用内结算">
              <span class="en">Testing In-app Billing</span></a>
      </li>
      <li><a href="../../google/play/billing/billing_admin.html" zh-cn-lang="管理应用内结算">
              <span class="en">Administering In-app Billing</span></a>
      </li>
      <li><a href="../../google/play/billing/versions.html">
              <span class="en">Version Notes</span></a>
      </li>
    </ul>
  </li>



   <li class="nav-section">
      <div class="nav-section-header"><a href="../../google/gcm/index.html">
        <span class="en">Google Cloud Messaging</span></a>
      </div>
      <ul>
        <li><a href="../../google/gcm/gcm.html">
            <span class="en">Overview</span></a>
        </li>
        <li><a href="../../google/gcm/gs.html">
            <span class="en">Getting Started</span></a>
        </li>
        <li><a href="../../google/gcm/client.html">
            <span class="en">Implementing GCM Client</span></a>
        </li>
        <li class="nav-section"><div class="nav-section-header"><a href="../../google/gcm/server.html">
              <span class="en">Implementing GCM Server</span></a></div>
              <ul>
              <li><a href="../../google/gcm/ccs.html">
              <span class="en">CCS (XMPP)</span></a></li>
              <li><a href="../../google/gcm/http.html">
              <span class="en">HTTP</span></a></li>
              </ul>
        </li>
        <li><a href="../../google/gcm/server-ref.html">
            <span class="en">Server Reference</span></a>
        </li>
        <li><a href="../../google/gcm/notifications.html">
              <span class="en">User Notifications</span></a>
        </li>
        <li><a href="../../google/gcm/c2dm.html">
            <span class="en">Migration</span></a>
        </li>
      </ul>
  </li>

  <li class="nav-section">
  <div class="nav-section-header empty"><a href="../../google/gcs/index.html">
        <span class="en">Google Cloud Save</span></a>
      </div>
  </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/play/dist.html">
      <span class="en">Google Play Distribution</span></a>
    </div>
    <ul>
      <li><a href="../../google/play/filters.html">
          <span class="en">Filters on Google Play</span></a>
      </li>
      <li><a href="../../google/play/billing/gp-purchase-status-api.html">
              <span class="en">Google Play Developer API</span></a>
      </li>
      <li><a href="../../google/play/publishing/multiple-apks.html">
          <span class="en">Multiple APK Support</span></a>
      </li>
      <li><a href="../../google/play/expansion-files.html">
          <span class="en">APK Expansion Files</span></a>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="../../google/play/licensing/index.html">
          <span class="en">Application Licensing</span></a>
        </div>
        <ul>
          <li><a href="../../google/play/licensing/overview.html">
              <span class="en">Licensing Overview</span></a>
          </li>
          <li><a href="../../google/play/licensing/setting-up.html">
              <span class="en">Setting Up for Licensing</span></a>
          </li>
          <li><a href="../../google/play/licensing/adding-licensing.html">
              <span class="en">Adding Licensing to Your App</span></a>
          </li>
          <li><a href="../../google/play/licensing/licensing-reference.html">
              <span class="en">Licensing Reference</span></a>
          </li>
        </ul>
      </li>

  <li class="nav-section">
    <div class="nav-section-header"><a href="../../google/backup/index.html">
      Android Backup Service</a>
    </div>
    <ul>
      <li><a href="../../google/backup/signup.html">
          Register</a>
      </li>
    </ul>
  </li>

  </ul>

</li>



</ul>

<script type="text/javascript">
<!--
    buildToggleLists();
    changeNavLang(getLangPref());
//-->
</script>


        

      </div>
      <script type="text/javascript">
       showGoogleRefTree();
    
      </script>
    </div> <!-- end side-nav -->
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="col-12" id="doc-col" >


  

  
    
      
        <h1 itemprop="name" >Implementing GCM Server</h1>
      
    
  


  
  <div id="jd-content">


    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
<div id="qv">

<h2>In this document</h2>

<ol class="toc">
  <li><a href="#role">Role of the 3rd-party Application Server</a></li>
  <li><a href="#choose">Choosing a GCM Connection Server</a></li>
  <li><a href="#send-msg">Sending Messages</a>
    <ol class="toc">

      <li><a href="#target">Target</a></li>
      <li><a href="#payload">Payload</a></li>
      <li><a href="#params">Message parameters</a>
    </ol>
    </li>
  <li><a href="#adv">Messaging Concepts and Best Practices</a>

   <ol class="toc">

      <li><a href="#collapsible">Send-to-Sync vs. Messages with Payload</a></li>
      <li><a href="#ttl">Setting an Expiration Date for a Message</a></li>
      <li><a href="#multi-senders">Receiving Messages from Multiple Senders</a>
      <li><a href="#lifetime">Lifetime of a Message</a>
      <li><a href="#throttling">Throttling</a>
    </ol>

</li>
  </li>

</ol>

<h2>See Also</h2>

<ol class="toc">
<li><a href="server-ref.html">Server Reference</a></li>
<li><a href="gs.html">Getting Started</a></li>
<li><a href="client.html">Implementing GCM Client</a></li>
<li><a href="ccs.html">Cloud Connection Server (XMPP)</a></li>
<li><a href="http.html">HTTP Connection Server</a></li>


</ol>

</div>
</div>


<p>The server side of Google Cloud Messaging (GCM) consists of two components:</p>
<ul>
<li>Google-provided <strong>GCM Connection Servers</strong>
take messages from a <a href="../../google/gcm/server.html#role">3rd-party app server</a>
and send them to a GCM-enabled
application (the &quot;client app&quot;) running on a device. For example,
Google provides connection servers for <a href="../../google/gcm/http.html">
HTTP</a> and <a href="../../google/gcm/ccs.html">XMPP (CCS)</a> (XMPP).</li>
<li>A <strong>3rd-party application server</strong> that you must implement. This application
server sends data to a GCM-enabled client app via the chosen GCM connection server.</li>
</ul>
</p>

<p>A full GCM implementation requires both a client implementation and a server
implementation. For more
information about implementing the client side, see <a href="client.html">
Implementing GCM Client</a>.</p>


<h2 id="role">Role of the 3rd-party Application Server</h2>

<p>Before you can write client apps that use the GCM feature, you must
have an  application server that meets the following criteria:</p>

<ul>
  <li>Able to communicate with your client.</li>
  <li>Able to  fire off properly formatted requests to the GCM server.</li>
  <li>Able to handle requests and resend them as needed, using
<a href="http://en.wikipedia.org/wiki/Exponential_backoff">exponential back-off.</a></li>
  <li>Able to store the API key and client registration IDs. In HTTP, the API key is
included in the header of POST requests that send messages. In XMPP, the API key is
used in the SASL PLAIN authentication request as a password to authenticate the connection.</li>
 <li>Able to generate message IDs to uniquely identify each message it sends. Message IDs
should be unique per sender ID.</li>
</ul>

<p>Here are the basic steps you follow to implement your 3rd-party app server:</p>

<ul>
      <li>Decide which GCM connection server(s) you want to use. Note that if you want to use
      upstream messaging from your client applications, you must use XMPP (CCS). For a more detailed
      discussion of this, see <a href="#choose">
      Choosing a GCM Connection Server</a>.</li>
      <li>Decide how you want to implement your app server. We provide helper libraries and code
samples to assist you with your 3rd-party app server implementation. For example:
        <ul>
          <li>If you decide to use the HTTP connection server, you can use the
GCM server helper library and demo app to help in implementing your app server.</li>
          <li>If you decide to use the XMPP connection server, you can use
the provided Python or Java <a href="http://www.igniterealtime.org/projects/smack/">
Smack</a> demo apps as a starting point.</li>
        <li>Note that Google AppEngine does not support connections to XMPP (CCS).</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


<h2 id="choose">Choosing a GCM Connection Server</h2>

<p>Currently GCM provides two connection servers: <a href="../../google/gcm/http.html">
HTTP</a> and <a href="../../google/gcm/ccs.html">XMPP (CCS)</a>. You can use them
separately or in tandem. XMPP (CCS) messaging differs from HTTP messaging in the following ways:</p>
<ul>
  <li>Upstream/Downstream messages
    <ul>
      <li>HTTP: Downstream only, cloud-to-device up to 4KB of data. </li>
      <li>XMPP (CCS): Upstream and downstream (device-to-cloud, cloud-to-device),
        up to 4 KB of data. </li>
    </ul>
  </li>
  <li>Messaging (synchronous or asynchronous)
    <ul>
      <li>HTTP: Synchronous. 3rd-party app servers send messages as HTTP POST requests and
wait for a response. This mechanism is synchronous and blocks the sender from sending
another message until the response is received.</li>
      <li>XMPP (CCS): Asynchronous. 3rd-party app servers send/receive messages to/from all their
devices at full line speed over persistent XMPP connections.
XMPP (CCS) sends acknowledgment or failure notifications (in the
form of special ACK and NACK JSON-encoded XMPP messages) asynchronously.</li>
    </ul>
  </li>

  <li>JSON
    <ul>
      <li>HTTP: JSON messages sent as HTTP POST.</li>
      <li>XMPP (CCS): JSON messages encapsulated in XMPP messages.</li>
    </ul>
  </li>
  <li>Plain Text
    <ul>
      <li>HTTP: Plain Text messages sent as HTTP POST.</li>
      <li>XMPP (CCS): Not supported.</li>
    </ul>
  </li>
  <li>Multicast downstream send to multiple registration IDs.
    <ul>
      <li>HTTP: Supported in JSON message format.</li>
      <li>XMPP (CCS): Not supported.</li>
    </ul>
  </li>
</ul>


<h2 id="send-msg">Sending Messages</h2>

<p>This section gives an overview of sending messages. For details of message syntax,
see <a href="../../google/gcm/server-ref.html">Server Reference</a>.</p>

<h3>Overview</h3>

<p>Here is the general sequence of events that occurs when a 3rd-party application
server sends a message (the details vary depending on the platform):</p>
<ol>
  <li>The 3rd-party app server sends a message to GCM servers.</li>
  <li>The GCM connection server enqueues and stores the message if the device is offline.</li>
  <li>When the device is online, GCM connection server sends the message to the device.</li>
  <li>The client app processes the message. </li>
</ol>

<h3>Implement send request</h3>

<p>The following sections describe the basic components involved in
sending a request. See the <a href="../../google/gcm/server-ref.html">Server Reference</a>
for details.</p>

<h4 id="target">Target</h4>
<p>Required. When your app server sends a message in GCM, it must specify a target.</p>
<p>For HTTP you must specify the target as one of the following:</p>
<ul>
<li><code>registration_ids</code>: For sending to 1 or more devices (up to 1000).
When you send a message to multiple registration IDs, that is called a multicast message.</li>
<li><code>notification_key</code>: For sending to multiple devices owned by a single user.</li>
</ul>
<p>For CCS (XMPP) you must specify the target as:</p>
<ul>
<li><code>to</code>: This
field may contain a single registration ID or a notification key.
XMPP (CCS) does not support multicast messaging.</li>
</ul>

<h4 id="options">Options</h4>

<p>There are various options the 3rd-party app server can set when sending a downstream
message to a client app. See the <a href="../../google/gcm/server-ref.html#table1">
Server Reference</a> for details. Here are a few examples of possible options:</p>

<ul>
  <li><code>collapse_key</code>: whether a message should be "send-to-sync" or a "message with
payload".</li>
  <li><code>time_to_live</code>: setting an expiration date for a message.</li>
  <li><code>dry_run</code>: Test your server.
<p>If you want to test your request (either JSON or plain text) without delivering
the message to the devices, you can set an optional HTTP parameter called
<code>dry_run</code> with the value <code>true</code>. The result will be almost
identical to running the request without this parameter, except that the message
will not be delivered to the devices. Consequently, the response will contain fake
IDs for the message and multicast parameters.</p>
</li>
</ul>

<h4 id="payload">Payload</h4>
<p>Optional. If you are including a payload in the message, you use the <code>data</code>
parameter to include the payload. This applies for both HTTP and XMPP.</p>

<p>See the <a href="../../google/gcm/server-ref.html">Server Reference</a> for details on sending
and receiving messages.</p>

<h2 id="adv">Messaging Concepts and Best Practices</h2>

<p>This section has a discussion of general messaging topics.</p>

<h3 id="collapsible">Send-to-Sync  vs. Messages with Payload</h3>

<p>Every message sent in GCM has the following characteristics:</p>
<ul>
  <li>It has a payload limit of 4096 bytes.</li>
  <li>By default, it is stored by GCM for 4 weeks.</li>
</ul>

<p>But despite these similarities, messages can behave very differently depending
on their particular settings. One major distinction between messages is whether
they are collapsed (where each new message replaces the preceding message) or not
collapsed (where each individual message is delivered). Every message sent in GCM
is either a &quot;send-to-sync&quot; (collapsible) message or a &quot;message with
payload&quot; (non-collapsible message).</p>

<h4 id="s2s">Send-to-sync messages</h4>

<p>A send-to-sync (collapsible) message is often a &quot;tickle&quot; that tells
a mobile application to sync data from the server. For example, suppose you have
an email application. When a user receives new email on the server, the server
pings the mobile application with a &quot;New mail&quot; message. This tells the
application to sync to the server to pick up the new email. The server might send
this message multiple times as new mail continues to accumulate, before the application
has had a chance to sync. But if the user has received 25 new emails, there's no
need to preserve every &quot;New mail&quot; message. One is sufficient. Another
example would be a sports application that updates users with the latest score.
Only the most recent message is relevant. </p>

<p>GCM allows a maximum of 4 different collapse keys to be used by the GCM server
at any given time. In other words, the GCM server can simultaneously store 4
different send-to-sync messages per device, each with a different collapse key.
For example, Device A can have A1, A2, A3, and A4. Device B can have B1, B2, B3,
and B4, and so on. If you exceed this number GCM will only keep 4 collapse keys, with no
guarantees about which ones they will be.</p>

<h3 id="payload">Messages with payload</h3>

<p>Unlike a send-to-sync message, every &quot;message with payload&quot;
(non-collapsible message) is delivered. The payload the message contains can be
up to 4kb. For example, here is a JSON-formatted message in an IM application in
which spectators are discussing a sporting event:</p>

<pre class="prettyprint pretty-json">{
  "registration_id" : "APA91bHun4MxP5egoKMwt2KZFBaFUH-1RYqx...",
  "data" : {
    "Nick" : "Mario",
    "Text" : "great match!",
    "Room" : "PortugalVSDenmark",
  },
}</pre>

<p>A &quot;message with payload&quot; is not simply a &quot;ping&quot; to the
mobile application to contact the server to fetch data. In the aforementioned IM
application, for example, you would want to deliver every message, because every
message has different content. To specify a non-collapsible message, you simply
omit the <code>collapse_key</code> parameter. Thus GCM will send each message
individually. Note that the order of delivery is not guaranteed.</p>

<p>GCM will store up to 100 non-collapsible messages. After that, all messages
are discarded from GCM, and a new message is created that tells the client how
far behind it is.</p>

<p>The application should respond by syncing with the server to recover the
discarded messages. </p>

<h4 id="which">Which should I use?</h4>
  <p>If your application does not need to use non-collapsible messages, collapsible
messages are a better choice from a performance standpoint. However, if you use
collapsible messages, remember that <strong>GCM only allows a maximum of 4 different collapse
keys to be used by the GCM server per registration ID at any given time</strong>. You must
not exceed this number, or it could cause unpredictable consequences.</p>

<h3 id="ttl">Setting an Expiration Date for a Message</h3>
<p>You can use the <code>time_to_live</code> parameter in the send request
to specify the maximum lifespan of a message.
The value of this parameter must be a duration from 0 to 2,419,200 seconds, and
it corresponds to the maximum period of time for which GCM will store and try to
deliver the message. Requests that don't contain this field default to the maximum
period of 4 weeks.</p>
<p>Here are some possible uses for this feature:</p>
<ul>
  <li>Video chat incoming calls</li>
  <li>Expiring invitation events</li>
  <li>Calendar events</li>
</ul>
<h4 id="bg">Background </h4>
<p>GCM usually delivers messages immediately after they are sent. However,
this might not always be possible. For example, if the platform is Android,
the device could be turned off, offline, or otherwise unavailable.
Or the sender itself might request
that messages not be delivered until the device becomes active by using the
<code>delay_while_idle</code> flag. Finally, GCM might intentionally delay messages
to prevent an application from consuming excessive resources and negatively
impacting battery life.</p>

<p>When this happens, GCM will store the message and deliver it as soon as it's
feasible. While this is fine in most cases, there are some applications for which
a late message might as well never be delivered. For example, if the message is
an incoming call or video chat notification, it will only be meaningful for a
small period of time before the call is terminated. Or if the message is an
invitation to an event, it will be useless if received after the event has ended.</p>

<p>Another advantage of specifying the expiration date for a message is that GCM
will never throttle messages with a <code>time_to_live</code> value of 0 seconds.
In other words, GCM will guarantee best effort for messages that must be delivered
&quot;now or never.&quot; Keep in mind that a <code>time_to_live</code> value of
0 means messages that can't be delivered immediately will be discarded. However,
because such messages are never stored, this provides the best latency for
sending notifications.</p>

<p>Here is an example of a JSON-formatted request that includes TTL:</p>
<pre class="prettyprint pretty-json">
{
  "collapse_key" : "demo",
  "delay_while_idle" : true,
  "registration_ids" : ["xyz"],
  "data" : {
    "key1" : "value1",
    "key2" : "value2",
  },
  "time_to_live" : 3
},
</pre>


<h3 id="multi-senders">Receiving Messages from Multiple Senders</h3>

<p>GCM allows multiple parties to send messages to the same application. For
example, suppose your application is an articles aggregator with multiple
contributors, and you want each of them to be able to send a message when they
publish a new article. This message might contain a URL so that the application
can download the article. Instead of having to centralize all sending activity in
one location, GCM gives you the ability to let each of these contributors send
its own messages.</p>

<p>To make this possible, all you need to do is have each sender generate its own
project number. Then include those IDs in the sender field, separated by commas,
when requesting a registration. Finally, share the registration ID with your
partners, and they'll be able to send messages to your application using their
own authentication keys.</p>

<p>Note that there is limit of 100 multiple senders.</p>

<h3 id="lifetime">Lifetime of a Message</h3>

<p>When a 3rd-party server posts a message to GCM and receives a message ID back,
it does not mean that the message was already delivered to the device. Rather, it
means that it was accepted for delivery. What happens to the message after it is
accepted depends on many factors.</p>

<p>In the best-case scenario, if the device is connected to GCM, the screen is on,
and there are no throttling restrictions (see <a href="#throttling">Throttling</a>),
the message will be delivered right away.</p>

<p>If the device is connected but idle, the message will still be
delivered right away unless the <code>delay_while_idle</code> flag is set to true.
Otherwise, it will be stored in the GCM servers until the device is awake. And
that's where the <code>collapse_key</code> flag plays a role: if there is already
a message with the same collapse key (and registration ID) stored and waiting for
delivery, the old message will be discarded and the new message will take its place
(that is, the old message will be collapsed by the new one). However, if the collapse
key is not set, both the new and old messages are stored for future delivery.
Collapsible messages are also called <a href="#s2s">send-to-sync messages</a>.</p>

<p class="note"><strong>Note:</strong> There is a limit on how many messages can
be stored without collapsing. That limit is currently 100. If the limit is reached,
all stored messages are discarded. Then when the device is back online, it receives
a special message indicating that the limit was reached. The application can then
handle the situation properly, typically by requesting a full sync.
<br><br>
Likewise, there is a limit on how many <code>collapse_key</code>s you can have for
a particular device. GCM allows a maximum of 4 different collapse keys to be used
by the GCM server per device
any given time. In other words, the GCM server can simultaneously store 4 different
send-to-sync messages, each with a different collapse key. If you exceed this number
GCM will only keep 4 collapse keys, with no guarantees about which ones they will be.
See <a href="#s2s">Send-to-sync messages</a> for more information.
</p>

<p>If the device is not connected to GCM, the message will be stored until a
connection is established (again respecting the collapse key rules). When a connection
is established, GCM will deliver all pending messages to the device, regardless of
the <code>delay_while_idle</code> flag. If the device never gets connected again
(for instance, if it was factory reset), the message will eventually time out and
be discarded from GCM storage. The default timeout is 4 weeks, unless the
<code>time_to_live</code> flag is set.</p>

<p>Finally, when GCM attempts to deliver a message to the device and the
application was uninstalled, GCM will discard that message right away and
invalidate the registration ID. Future attempts to send a message to that device
will get a <code>NotRegistered</code> error. See <a href="#unreg">
How Unregistration Works</a> for more information.</p>
<p>Although is not possible to track the status of each individual message, the
Google Cloud Console stats are broken down by messages sent to device, messages
collapsed, and messages waiting for delivery.</p>

<h3 id="throttling">Throttling</h3>
<p>To prevent abuse (such as sending a flood of messages to a device) and
to optimize for the overall network efficiency and battery life of
devices, GCM implements throttling of messages using a token bucket
scheme. Messages are throttled on a per application and per <a href="#collapsible">collapse
key</a> basis (including non-collapsible messages). Each application
collapse key is granted some initial tokens, and new tokens are granted
periodically therefter. Each token is valid for a single message sent to
the device. If an application collapse key exhausts its supply of
available tokens, new messages are buffered in a pending queue until
new tokens become available at the time of the periodic grant. Thus
throttling in between periodic grant intervals may add to the latency
of message delivery for an application collapse key that sends a large
number of messages within a short period of time. Messages in the pending
queue of an application collapse key may be delivered before the time
of the next periodic grant, if they are piggybacked with messages
belonging to a non-throttled category by GCM for network and battery
efficiency reasons.</p>



    </div>

      <div class="content-footer layout-content-row"
                    itemscope itemtype="http://schema.org/SiteNavigationElement">
        
        <div class="paging-links layout-content-col col-10">
          
        </div>
        <div class="layout-content-col plus-container col-2" >
          
            <div class="g-plusone" data-size="medium"></div>
          
        </div>
        
      </div>

  </div> <!-- end jd-content -->

<div id="footer" class="wrap" >
        

  <div id="copyright">
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="../../license.html">Content 
  License</a>.
  </div>


  <div id="footerlinks">
    
  <p>
    <a href="../../about/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
    <a href="../../support.html">Support</a>
  </p>
  </div>

</div> <!-- end footer -->
</div><!-- end doc-content -->

</div> <!-- end body-content --> 





  <script src="https://developer.android.com/ytblogger_lists_unified.js" type="text/javascript"></script>
  <script src="../../jd_lists_unified.js?v=8" type="text/javascript"></script>
  <script src="../../jd_extras.js?v=9" type="text/javascript"></script>
  <script src="../../jd_collections.js?v=9" type="text/javascript"></script>
  <script src="../../jd_tag_helpers.js?v=5" type="text/javascript"></script>

</body>
</html>



